# Release Notes

## Ver 2.2.2 (2026-02-24)

### 主な変更

#### 保護者マイページの大幅刷新 (Overhaul)
- **統合カレンダーの導入**
  - カレンダーに「予約」「変更申請」「お知らせ」の3つのモードを統合
  - 予約モード：複数日の一括選択と、サイドパネルからのクイック予約が可能に
  - 変更申請モード：既存予約の編集に加え、過去の日付に対する「修正希望」リクエスト機能を追加
  - お知らせモード：配信されたおたよりをカレンダー上で直接確認・プレビュー可能に

- **ナビゲーションの統合と整理**
  - 旧「予約」ページを廃止し、ホーム画面のカレンダー機能に集約
  - ボトムナビゲーションを整理し、ユーザー体験を向上
  - 未使用のモックナビゲーションを削除

- **児童表示の堅牢性向上**
  - 児童名が表示されない場合のフォールバック処理を強化（フルネーム、ID等を使用）
  - 右上のメッセージボタンを削除し、一貫した導線を確保

- **予約リストの改善**
  - 今後の予約を時系列でソートして表示
  - 初期表示件数を5件に制限し、展開（もっと見る）機能を追加

#### 管理者機能の改善
- **ダッシュボードの利便性向上**
  - 選択した日付を URL パラメータに保存し、リロード後も状態を維持
  - 「今日に戻る」ボタンを追加

- **ログイン動線の固定**
  - 管理者・職員ログイン後の遷移先を管理ダッシュボードに固定

### 破壊的変更
1. **保護者用予約URLの廃止**
   - 旧：`/parent/reserve`
   - 新：`/parent/home` 内の統合カレンダー
   - 既存のリンクは自動的にホームへ誘導されるか、ナビゲーションから削除されています。

---

## Ver 7.1 (2026-02-10)

### 主な変更

#### 用語の統一
- **Guardian → Parent への完全リネーム**
  - すべてのコード、UI、ドキュメントで用語を統一
  - より直感的で理解しやすい命名に変更

#### データベース変更
- **新規コレクション**
  - `parents` コレクション作成（旧 `guardians`）
  - Email ベース認証に統一

- **フィールド名変更**
  - `children.guardianIds` → `children.parentIds`
  - `children.guardianName` → `children.parentName`
  - `authorizedEmails` 廃止（`parentIds` に統合）

#### ルーティング変更
- `/guardian/*` → `/parent/*`
  - `/parent/login` - 保護者ログイン
  - `/parent/home` - 保護者ホーム
  - `/parent/reserve` - 予約管理
  - `/parent/payment` - 支払い管理
  - `/parent/documents` - ドキュメント

#### Security Rules 更新
- `parents` コレクションのアクセス制御追加
- `staff_users` ベースの認証に変更
- 後方互換性確保（`authorizedEmails` サポート継続）

#### GAS スクリプト
- Ver 7.1 デプロイ
- `Master_Guardians` → `Master_Parents` シート名変更
- `GuardianIDs` → `ParentIDs` 列名変更

### 破壊的変更

⚠️ 以下の変更により、既存のコードやデータに影響があります：

1. **ルート変更**
   - 旧: `/guardian/*`
   - 新: `/parent/*`
   - ブックマークや直リンクの更新が必要

2. **コレクション名**
   - 旧: `guardians`
   - 新: `parents`
   - データマイグレーション実施済み

3. **フィールド名**
   - 旧: `guardianIds`, `guardianName`
   - 新: `parentIds`, `parentName`
   - データマイグレーション実施済み

### マイグレーション

データマイグレーションは自動実行済みです。

- `guardians` → `parents` コレクション作成
- `children` レコードのフィールド名更新
- `attendance` メッセージの送信者フィールド更新

### 既知の問題

1. **Turbopack ビルドエラー**
   - `npm run build` が失敗する場合があります
   - 回避策: `firebase deploy --only hosting` を使用
   - 開発サーバー（`npm run dev`）は正常動作

### アップグレード手順

Ver 6.3 から Ver 7.1 へのアップグレード：

1. コードを最新版に更新
2. `firebase deploy --only firestore:rules` で Security Rules デプロイ
3. `firebase deploy --only hosting` でフロントエンドデプロイ
4. スプレッドシートのシート名・列名を手動更新
5. GAS スクリプト Ver 7.1 をデプロイ

---

## Ver 6.3 (2026-01)

### 主な変更
- GAS 統合、データ同期機能
- 管理画面の改善
- CSV インポート/エクスポート機能

---

## Ver 6.1

### 主な変更
- 基本機能の実装
- 認証システム
- 出席管理
- 予約システム
